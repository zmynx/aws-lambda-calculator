openapi: 3.0.3
info:
  title: AWS Lambda Cost Calculator API
  description: |
    API for calculating AWS Lambda function costs based on various parameters including:
    - Number of requests
    - Average duration
    - Memory allocation
    - AWS region
    - Architecture (x86 or arm64)
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com

servers:
  - url: https://api.example.com
    description: Production server
  - url: https://staging-api.example.com
    description: Staging server

paths:
  /:
    post:
      summary: Calculate AWS Lambda costs
      description: Calculates the cost of running AWS Lambda functions based on provided parameters
      operationId: calculateLambdaCost
      tags:
        - Calculator
      x-amazon-apigateway-integration:
        type: aws_proxy
        httpMethod: POST
        uri:
          Fn::Sub: "arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${LambdaFunction.Arn}/invocations"
        responses:
          default:
            statusCode: "200"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CalculationRequest"
            examples:
              basicExample:
                summary: Basic calculation example
                value:
                  region: "us-east-1"
                  architecture: "x86"
                  number_of_requests: 1000000
                  number_of_requests_unit: "per month"
                  average_duration: 1500
                  allocated_memory: 128
                  allocated_memory_unit: "MB"
                  ephemeral_storage: 512
                  ephemeral_storage_unit: "MB"
              armExample:
                summary: ARM architecture example
                value:
                  region: "eu-west-1"
                  architecture: "arm64"
                  number_of_requests: 500000
                  number_of_requests_unit: "per day"
                  average_duration: 500
                  allocated_memory: 256
                  allocated_memory_unit: "MB"
                  ephemeral_storage: 1024
                  ephemeral_storage_unit: "MB"
      responses:
        "200":
          description: Successful calculation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CalculationResponse"
              example:
                status: "success"
                result:
                  total_cost_per_month: 21.42
                  compute_cost_per_month: 20.00
                  request_cost_per_month: 0.20
                  ephemeral_storage_cost_per_month: 1.22
                  free_tier_applied: true
                  breakdown:
                    compute_gb_seconds: 192000
                    free_compute_gb_seconds: 400000
                    billable_compute_gb_seconds: 0
                    total_requests: 1000000
                    free_requests: 1000000
                    billable_requests: 0
        "400":
          description: Bad Request - Invalid parameters
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                status: "error"
                message: "Invalid region specified"
                details:
                  region: "Region 'invalid-region' is not supported"
        "429":
          description: Too Many Requests - Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                status: "error"
                message: "Rate limit exceeded. Please try again later."
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                status: "error"
                message: "An internal error occurred"

components:
  schemas:
    CalculationRequest:
      type: object
      required:
        - region
        - architecture
        - number_of_requests
        - average_duration
        - allocated_memory
      properties:
        region:
          type: string
          description: AWS region for pricing calculation
          enum:
            - us-east-1
            - us-east-2
            - us-west-1
            - us-west-2
            - eu-west-1
            - eu-west-2
            - eu-west-3
            - eu-central-1
            - eu-north-1
            - ap-southeast-1
            - ap-southeast-2
            - ap-northeast-1
            - ap-northeast-2
            - ap-south-1
            - sa-east-1
            - ca-central-1
          example: "us-east-1"
        architecture:
          type: string
          description: Lambda function architecture
          enum:
            - x86
            - arm64
          example: "x86"
        number_of_requests:
          type: integer
          minimum: 0
          description: Number of Lambda invocations
          example: 1000000
        number_of_requests_unit:
          type: string
          description: Time unit for number of requests
          enum:
            - per second
            - per minute
            - per hour
            - per day
            - per month
          default: "per month"
          example: "per month"
        average_duration:
          type: number
          minimum: 0
          maximum: 900000
          description: Average duration of Lambda execution in milliseconds
          example: 1500
        allocated_memory:
          type: integer
          minimum: 128
          maximum: 10240
          description: Amount of memory allocated to Lambda function
          example: 128
        allocated_memory_unit:
          type: string
          description: Unit for allocated memory
          enum:
            - MB
            - GB
          default: "MB"
          example: "MB"
        ephemeral_storage:
          type: integer
          minimum: 512
          maximum: 10240
          description: Amount of ephemeral storage allocated
          default: 512
          example: 512
        ephemeral_storage_unit:
          type: string
          description: Unit for ephemeral storage
          enum:
            - MB
            - GB
          default: "MB"
          example: "MB"

    CalculationResponse:
      type: object
      properties:
        status:
          type: string
          enum:
            - success
            - error
          example: "success"
        result:
          type: object
          properties:
            total_cost_per_month:
              type: number
              format: float
              description: Total estimated cost per month in USD
              example: 21.42
            compute_cost_per_month:
              type: number
              format: float
              description: Compute cost per month in USD
              example: 20.00
            request_cost_per_month:
              type: number
              format: float
              description: Request cost per month in USD
              example: 0.20
            ephemeral_storage_cost_per_month:
              type: number
              format: float
              description: Ephemeral storage cost per month in USD
              example: 1.22
            free_tier_applied:
              type: boolean
              description: Whether AWS free tier was applied to the calculation
              example: true
            breakdown:
              type: object
              properties:
                compute_gb_seconds:
                  type: number
                  description: Total compute GB-seconds
                  example: 192000
                free_compute_gb_seconds:
                  type: number
                  description: Free tier compute GB-seconds
                  example: 400000
                billable_compute_gb_seconds:
                  type: number
                  description: Billable compute GB-seconds after free tier
                  example: 0
                total_requests:
                  type: integer
                  description: Total number of requests
                  example: 1000000
                free_requests:
                  type: integer
                  description: Free tier requests
                  example: 1000000
                billable_requests:
                  type: integer
                  description: Billable requests after free tier
                  example: 0

    ErrorResponse:
      type: object
      properties:
        status:
          type: string
          enum:
            - error
          example: "error"
        message:
          type: string
          description: Error message
          example: "Invalid parameters provided"
        details:
          type: object
          additionalProperties:
            type: string
          description: Additional error details
          example:
            field: "region"
            error: "Region must be one of the supported AWS regions"

tags:
  - name: Calculator
    description: Lambda cost calculation operations

security:
  - {} # No security required for this public API

x-amazon-apigateway-request-validators:
  basic:
    validateRequestBody: true
    validateRequestParameters: false

x-amazon-apigateway-gateway-responses:
  DEFAULT_4XX:
    responseParameters:
      gatewayresponse.header.Access-Control-Allow-Origin: "'*'"
    responseTemplates:
      application/json: '{"status": "error", "message": "$context.error.message"}'
  DEFAULT_5XX:
    responseParameters:
      gatewayresponse.header.Access-Control-Allow-Origin: "'*'"
    responseTemplates:
      application/json: '{"status": "error", "message": "$context.error.message"}'

