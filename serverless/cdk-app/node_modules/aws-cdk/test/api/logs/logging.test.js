"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const logging_1 = require("../../../lib/logging");
describe('logging', () => {
    let mockStdout;
    let mockStderr;
    const stripAnsi = (str) => {
        const ansiRegex = /\u001b\[[0-9;]*[a-zA-Z]/g;
        return str.replace(ansiRegex, '');
    };
    beforeEach(() => {
        (0, logging_1.setIoMessageThreshold)('info');
        (0, logging_1.setCI)(false);
        mockStdout = jest.fn();
        mockStderr = jest.fn();
        jest.spyOn(process.stdout, 'write').mockImplementation((chunk) => {
            mockStdout(stripAnsi(chunk.toString()));
            return true;
        });
        jest.spyOn(process.stderr, 'write').mockImplementation((chunk) => {
            mockStderr(stripAnsi(chunk.toString()));
            return true;
        });
    });
    afterEach(() => {
        jest.restoreAllMocks();
    });
    describe('stream selection', () => {
        test('data() always writes to stdout with both styles', () => {
            // String style
            (0, logging_1.data)('test message');
            expect(mockStdout).toHaveBeenCalledWith('test message\n');
            // Object style
            (0, logging_1.data)({ message: 'test message 2' });
            expect(mockStdout).toHaveBeenCalledWith('test message 2\n');
            expect(mockStderr).not.toHaveBeenCalled();
        });
        test('error() always writes to stderr with both styles', () => {
            // String style
            (0, logging_1.error)('test error');
            expect(mockStderr).toHaveBeenCalledWith('test error\n');
            // Object style
            (0, logging_1.error)({ message: 'test error 2' });
            expect(mockStderr).toHaveBeenCalledWith('test error 2\n');
            expect(mockStdout).not.toHaveBeenCalled();
        });
        test('info() writes to stderr by default with both styles', () => {
            // String style
            (0, logging_1.info)('test print');
            expect(mockStderr).toHaveBeenCalledWith('test print\n');
            // Object style
            (0, logging_1.info)({ message: 'test print 2' });
            expect(mockStderr).toHaveBeenCalledWith('test print 2\n');
            expect(mockStdout).not.toHaveBeenCalled();
        });
        test('info() writes to stdout in CI mode with both styles', () => {
            (0, logging_1.setCI)(true);
            // String style
            (0, logging_1.info)('test print');
            expect(mockStdout).toHaveBeenCalledWith('test print\n');
            // Object style
            (0, logging_1.info)({ message: 'test print 2' });
            expect(mockStdout).toHaveBeenCalledWith('test print 2\n');
            expect(mockStderr).not.toHaveBeenCalled();
        });
    });
    describe('log levels', () => {
        test('respects log level settings with both styles', () => {
            (0, logging_1.setIoMessageThreshold)('error');
            // String style
            (0, logging_1.error)('error message');
            (0, logging_1.warning)('warning message');
            (0, logging_1.info)('print message');
            // Object style
            (0, logging_1.error)({ message: 'error message 2' });
            (0, logging_1.warning)({ message: 'warning message 2' });
            (0, logging_1.info)({ message: 'print message 2' });
            expect(mockStderr).toHaveBeenCalledWith('error message\n');
            expect(mockStderr).toHaveBeenCalledWith('error message 2\n');
            expect(mockStderr).not.toHaveBeenCalledWith('warning message\n');
            expect(mockStderr).not.toHaveBeenCalledWith('warning message 2\n');
            expect(mockStderr).not.toHaveBeenCalledWith('print message\n');
            expect(mockStderr).not.toHaveBeenCalledWith('print message 2\n');
        });
        test('debug messages only show at debug level with both styles', () => {
            (0, logging_1.setIoMessageThreshold)('info');
            (0, logging_1.debug)('debug message');
            (0, logging_1.debug)({ message: 'debug message 2' });
            expect(mockStderr).not.toHaveBeenCalled();
            (0, logging_1.setIoMessageThreshold)('debug');
            (0, logging_1.debug)('debug message');
            (0, logging_1.debug)({ message: 'debug message 2' });
            expect(mockStderr).toHaveBeenCalledWith(expect.stringMatching(/^\[\d{2}:\d{2}:\d{2}\] debug message\n$/));
            expect(mockStderr).toHaveBeenCalledWith(expect.stringMatching(/^\[\d{2}:\d{2}:\d{2}\] debug message 2\n$/));
        });
        test('trace messages only show at trace level with both styles', () => {
            (0, logging_1.setIoMessageThreshold)('debug');
            (0, logging_1.trace)('trace message');
            (0, logging_1.trace)({ message: 'trace message 2' });
            expect(mockStderr).not.toHaveBeenCalled();
            (0, logging_1.setIoMessageThreshold)('trace');
            (0, logging_1.trace)('trace message');
            (0, logging_1.trace)({ message: 'trace message 2' });
            expect(mockStderr).toHaveBeenCalledWith(expect.stringMatching(/^\[\d{2}:\d{2}:\d{2}\] trace message\n$/));
            expect(mockStderr).toHaveBeenCalledWith(expect.stringMatching(/^\[\d{2}:\d{2}:\d{2}\] trace message 2\n$/));
        });
    });
    describe('formatted messages', () => {
        test('handles format strings correctly with both styles', () => {
            // String style
            (0, logging_1.info)('Hello %s, you have %d messages', 'User', 5);
            expect(mockStderr).toHaveBeenCalledWith('Hello User, you have 5 messages\n');
            // Object style
            (0, logging_1.info)({ message: 'Hello %s, you have %d messages' }, 'User', 5);
            expect(mockStderr).toHaveBeenCalledWith('Hello User, you have 5 messages\n');
        });
        test('handles objects in format strings with both styles', () => {
            const obj = { name: 'test' };
            // String style
            (0, logging_1.info)('Object: %j', obj);
            expect(mockStderr).toHaveBeenCalledWith('Object: {"name":"test"}\n');
            // Object style
            (0, logging_1.info)({ message: 'Object: %j' }, obj);
            expect(mockStderr).toHaveBeenCalledWith('Object: {"name":"test"}\n');
        });
        test('handles multiple style changes in single call', () => {
            const obj = { id: 123 };
            (0, logging_1.success)('Processing %s: %j at %d%%', 'task', obj, 50);
            expect(mockStderr).toHaveBeenCalledWith('Processing task: {"id":123} at 50%\n');
        });
    });
    describe('styled output', () => {
        test('success() adds green color to output with both styles', () => {
            // String style
            (0, logging_1.success)('operation completed');
            expect(mockStderr).toHaveBeenCalledWith('operation completed\n');
            // Object style
            (0, logging_1.success)({ message: 'operation completed 2' });
            expect(mockStderr).toHaveBeenCalledWith('operation completed 2\n');
        });
        test('highlight() adds bold formatting to output with both styles', () => {
            // String style
            (0, logging_1.highlight)('important message');
            expect(mockStderr).toHaveBeenCalledWith('important message\n');
            // Object style
            (0, logging_1.highlight)({ message: 'important message 2' });
            expect(mockStderr).toHaveBeenCalledWith('important message 2\n');
        });
        test('success handles format strings with styling', () => {
            (0, logging_1.success)('completed task %d of %d', 1, 3);
            expect(mockStderr).toHaveBeenCalledWith('completed task 1 of 3\n');
            // Remove the code from the test since it's an implementation detail
            (0, logging_1.success)({ message: 'completed task %d of %d' }, 2, 3);
            expect(mockStderr).toHaveBeenCalledWith('completed task 2 of 3\n');
        });
        test('highlight handles complex objects with styling', () => {
            const complexObj = { status: 'active', count: 42 };
            (0, logging_1.highlight)('Status: %j', complexObj);
            expect(mockStderr).toHaveBeenCalledWith('Status: {"status":"active","count":42}\n');
            // Remove the code from the test since it's an implementation detail
            (0, logging_1.highlight)({ message: 'Status: %j' }, complexObj);
            expect(mockStderr).toHaveBeenCalledWith('Status: {"status":"active","count":42}\n');
        });
    });
    describe('edge cases', () => {
        test('handles null and undefined arguments with both styles', () => {
            // String style
            (0, logging_1.info)('Values: %s, %s', null, undefined);
            expect(mockStderr).toHaveBeenCalledWith('Values: null, undefined\n');
            // Object style
            (0, logging_1.info)({ message: 'Values: %s, %s' }, null, undefined);
            expect(mockStderr).toHaveBeenCalledWith('Values: null, undefined\n');
        });
        test('handles circular references in objects with both styles', () => {
            const obj = { name: 'test' };
            obj.self = obj;
            // String style
            (0, logging_1.info)('Object: %j', obj);
            expect(mockStderr).toHaveBeenCalledWith(expect.stringContaining('[Circular'));
            // Object style
            (0, logging_1.info)({ message: 'Object: %j' }, obj);
            expect(mockStderr).toHaveBeenCalledWith(expect.stringContaining('[Circular'));
        });
    });
    describe('message codes', () => {
        test('validates message codes correctly', () => {
            // Valid codes
            expect(() => (0, logging_1.error)({ message: 'test', code: 'CDK_TOOLKIT_E0001' })).not.toThrow();
            expect(() => (0, logging_1.warning)({ message: 'test', code: 'CDK_ASSETS_W4999' })).not.toThrow();
            expect(() => (0, logging_1.info)({ message: 'test', code: 'CDK_SDK_I0000' })).not.toThrow();
        });
        test('uses default codes when none provided', () => {
            (0, logging_1.error)('test error');
            expect(mockStderr).toHaveBeenCalledWith(expect.stringContaining('test error'));
            // Would need to modify the code to expose the actual message code for verification
        });
    });
    describe('corked logging', () => {
        test('buffers messages when corked', async () => {
            await (0, logging_1.withCorkedLogging)(async () => {
                (0, logging_1.info)('message 1');
                (0, logging_1.info)({ message: 'message 2' });
                expect(mockStderr).not.toHaveBeenCalled();
            });
            expect(mockStderr).toHaveBeenCalledWith('message 1\n');
            expect(mockStderr).toHaveBeenCalledWith('message 2\n');
        });
        test('handles nested corking correctly', async () => {
            await (0, logging_1.withCorkedLogging)(async () => {
                (0, logging_1.info)('outer 1');
                await (0, logging_1.withCorkedLogging)(async () => {
                    (0, logging_1.info)({ message: 'inner' });
                });
                (0, logging_1.info)({ message: 'outer 2' });
                expect(mockStderr).not.toHaveBeenCalled();
            });
            expect(mockStderr).toHaveBeenCalledTimes(3);
            expect(mockStderr).toHaveBeenCalledWith('outer 1\n');
            expect(mockStderr).toHaveBeenCalledWith('inner\n');
            expect(mockStderr).toHaveBeenCalledWith('outer 2\n');
        });
        test('handles errors in corked block while preserving buffer', async () => {
            await expect((0, logging_1.withCorkedLogging)(async () => {
                (0, logging_1.info)('message 1');
                throw new Error('test error');
            })).rejects.toThrow('test error');
            // The buffered message should still be printed even if the block throws
            expect(mockStderr).toHaveBeenCalledWith('message 1\n');
        });
        test('maintains correct order with mixed log levels in corked block', async () => {
            // Set threshold to debug to allow debug messages
            (0, logging_1.setIoMessageThreshold)('debug');
            await (0, logging_1.withCorkedLogging)(async () => {
                (0, logging_1.error)('error message');
                (0, logging_1.warning)('warning message');
                (0, logging_1.success)('success message');
                (0, logging_1.debug)('debug message');
            });
            const calls = mockStderr.mock.calls.map(call => call[0]);
            expect(calls).toEqual([
                'error message\n',
                'warning message\n',
                'success message\n',
                expect.stringMatching(/^\[\d{2}:\d{2}:\d{2}\] debug message\n$/),
            ]);
            // Reset threshold back to info for other tests
            (0, logging_1.setIoMessageThreshold)('info');
        });
    });
    describe('CI mode behavior', () => {
        test('correctly switches between stdout and stderr based on CI mode', () => {
            (0, logging_1.setCI)(true);
            (0, logging_1.warning)('warning in CI');
            (0, logging_1.success)('success in CI');
            (0, logging_1.error)('error in CI');
            expect(mockStdout).toHaveBeenCalledWith('warning in CI\n');
            expect(mockStdout).toHaveBeenCalledWith('success in CI\n');
            expect(mockStderr).toHaveBeenCalledWith('error in CI\n');
            (0, logging_1.setCI)(false);
            (0, logging_1.warning)('warning not in CI');
            (0, logging_1.success)('success not in CI');
            (0, logging_1.error)('error not in CI');
            expect(mockStderr).toHaveBeenCalledWith('warning not in CI\n');
            expect(mockStderr).toHaveBeenCalledWith('success not in CI\n');
            expect(mockStderr).toHaveBeenCalledWith('error not in CI\n');
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9nZ2luZy50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibG9nZ2luZy50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsa0RBQXFKO0FBRXJKLFFBQVEsQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFO0lBQ3ZCLElBQUksVUFBcUIsQ0FBQztJQUMxQixJQUFJLFVBQXFCLENBQUM7SUFFMUIsTUFBTSxTQUFTLEdBQUcsQ0FBQyxHQUFXLEVBQVUsRUFBRTtRQUN4QyxNQUFNLFNBQVMsR0FBRywwQkFBMEIsQ0FBQztRQUM3QyxPQUFPLEdBQUcsQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ3BDLENBQUMsQ0FBQztJQUVGLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxJQUFBLCtCQUFxQixFQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzlCLElBQUEsZUFBSyxFQUFDLEtBQUssQ0FBQyxDQUFDO1FBRWIsVUFBVSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUN2QixVQUFVLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBRXZCLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLEtBQVUsRUFBRSxFQUFFO1lBQ3BFLFVBQVUsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUN4QyxPQUFPLElBQUksQ0FBQztRQUNkLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDLGtCQUFrQixDQUFDLENBQUMsS0FBVSxFQUFFLEVBQUU7WUFDcEUsVUFBVSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ3hDLE9BQU8sSUFBSSxDQUFDO1FBQ2Qs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LGVBQUssRUFBQyxLQUFLLENBQUMsQ0FBQztZQUNiLElBQUEsaUJBQU8sRUFBQyxtQkFBbUIsQ0FBQyxDQUFDO1lBQzdCLElBQUEsaUJBQU8sRUFBQyxtQkFBbUIsQ0FBQyxDQUFDO1lBQzdCLElBQUEsZUFBSyxFQUFDLGlCQUFpQixDQUFDLENBQUM7WUFFekIsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLHFCQUFxQixDQUFDLENBQUM7WUFDL0QsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLHFCQUFxQixDQUFDLENBQUM7WUFDL0QsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLG1CQUFtQixDQUFDLENBQUM7UUFDL0QsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc2V0SW9NZXNzYWdlVGhyZXNob2xkLCBzZXRDSSwgZGF0YSwgc3VjY2VzcywgaGlnaGxpZ2h0LCBlcnJvciwgd2FybmluZywgaW5mbywgZGVidWcsIHRyYWNlLCB3aXRoQ29ya2VkTG9nZ2luZyB9IGZyb20gJy4uLy4uLy4uL2xpYi9sb2dnaW5nJztcblxuZGVzY3JpYmUoJ2xvZ2dpbmcnLCAoKSA9PiB7XG4gIGxldCBtb2NrU3Rkb3V0OiBqZXN0Lk1vY2s7XG4gIGxldCBtb2NrU3RkZXJyOiBqZXN0Lk1vY2s7XG5cbiAgY29uc3Qgc3RyaXBBbnNpID0gKHN0cjogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgICBjb25zdCBhbnNpUmVnZXggPSAvXFx1MDAxYlxcW1swLTk7XSpbYS16QS1aXS9nO1xuICAgIHJldHVybiBzdHIucmVwbGFjZShhbnNpUmVnZXgsICcnKTtcbiAgfTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBzZXRJb01lc3NhZ2VUaHJlc2hvbGQoJ2luZm8nKTtcbiAgICBzZXRDSShmYWxzZSk7XG5cbiAgICBtb2NrU3Rkb3V0ID0gamVzdC5mbigpO1xuICAgIG1vY2tTdGRlcnIgPSBqZXN0LmZuKCk7XG5cbiAgICBqZXN0LnNweU9uKHByb2Nlc3Muc3Rkb3V0LCAnd3JpdGUnKS5tb2NrSW1wbGVtZW50YXRpb24oKGNodW5rOiBhbnkpID0+IHtcbiAgICAgIG1vY2tTdGRvdXQoc3RyaXBBbnNpKGNodW5rLnRvU3RyaW5nKCkpKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xuXG4gICAgamVzdC5zcHlPbihwcm9jZXNzLnN0ZGVyciwgJ3dyaXRlJykubW9ja0ltcGxlbWVudGF0aW9uKChjaHVuazogYW55KSA9PiB7XG4gICAgICBtb2NrU3RkZXJyKHN0cmlwQW5zaShjaHVuay50b1N0cmluZygpKSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBqZXN0LnJlc3RvcmVBbGxNb2NrcygpO1xuICB9KTtcblxuICBkZXNjcmliZSgnc3RyZWFtIHNlbGVjdGlvbicsICgpID0+IHtcbiAgICB0ZXN0KCdkYXRhKCkgYWx3YXlzIHdyaXRlcyB0byBzdGRvdXQgd2l0aCBib3RoIHN0eWxlcycsICgpID0+IHtcbiAgICAgIC8vIFN0cmluZyBzdHlsZVxuICAgICAgZGF0YSgndGVzdCBtZXNzYWdlJyk7XG4gICAgICBleHBlY3QobW9ja1N0ZG91dCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3Rlc3QgbWVzc2FnZVxcbicpO1xuXG4gICAgICAvLyBPYmplY3Qgc3R5bGVcbiAgICAgIGRhdGEoeyBtZXNzYWdlOiAndGVzdCBtZXNzYWdlIDInIH0pO1xuICAgICAgZXhwZWN0KG1vY2tTdGRvdXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd0ZXN0IG1lc3NhZ2UgMlxcbicpO1xuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdlcnJvcigpIGFsd2F5cyB3cml0ZXMgdG8gc3RkZXJyIHdpdGggYm90aCBzdHlsZXMnLCAoKSA9PiB7XG4gICAgICAvLyBTdHJpbmcgc3R5bGVcbiAgICAgIGVycm9yKCd0ZXN0IGVycm9yJyk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3Rlc3QgZXJyb3JcXG4nKTtcblxuICAgICAgLy8gT2JqZWN0IHN0eWxlXG4gICAgICBlcnJvcih7IG1lc3NhZ2U6ICd0ZXN0IGVycm9yIDInIH0pO1xuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd0ZXN0IGVycm9yIDJcXG4nKTtcbiAgICAgIGV4cGVjdChtb2NrU3Rkb3V0KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnaW5mbygpIHdyaXRlcyB0byBzdGRlcnIgYnkgZGVmYXVsdCB3aXRoIGJvdGggc3R5bGVzJywgKCkgPT4ge1xuICAgICAgLy8gU3RyaW5nIHN0eWxlXG4gICAgICBpbmZvKCd0ZXN0IHByaW50Jyk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3Rlc3QgcHJpbnRcXG4nKTtcblxuICAgICAgLy8gT2JqZWN0IHN0eWxlXG4gICAgICBpbmZvKHsgbWVzc2FnZTogJ3Rlc3QgcHJpbnQgMicgfSk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3Rlc3QgcHJpbnQgMlxcbicpO1xuICAgICAgZXhwZWN0KG1vY2tTdGRvdXQpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdpbmZvKCkgd3JpdGVzIHRvIHN0ZG91dCBpbiBDSSBtb2RlIHdpdGggYm90aCBzdHlsZXMnLCAoKSA9PiB7XG4gICAgICBzZXRDSSh0cnVlKTtcbiAgICAgIC8vIFN0cmluZyBzdHlsZVxuICAgICAgaW5mbygndGVzdCBwcmludCcpO1xuICAgICAgZXhwZWN0KG1vY2tTdGRvdXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd0ZXN0IHByaW50XFxuJyk7XG5cbiAgICAgIC8vIE9iamVjdCBzdHlsZVxuICAgICAgaW5mbyh7IG1lc3NhZ2U6ICd0ZXN0IHByaW50IDInIH0pO1xuICAgICAgZXhwZWN0KG1vY2tTdGRvdXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd0ZXN0IHByaW50IDJcXG4nKTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbG9nIGxldmVscycsICgpID0+IHtcbiAgICB0ZXN0KCdyZXNwZWN0cyBsb2cgbGV2ZWwgc2V0dGluZ3Mgd2l0aCBib3RoIHN0eWxlcycsICgpID0+IHtcbiAgICAgIHNldElvTWVzc2FnZVRocmVzaG9sZCgnZXJyb3InKTtcblxuICAgICAgLy8gU3RyaW5nIHN0eWxlXG4gICAgICBlcnJvcignZXJyb3IgbWVzc2FnZScpO1xuICAgICAgd2FybmluZygnd2FybmluZyBtZXNzYWdlJyk7XG4gICAgICBpbmZvKCdwcmludCBtZXNzYWdlJyk7XG5cbiAgICAgIC8vIE9iamVjdCBzdHlsZVxuICAgICAgZXJyb3IoeyBtZXNzYWdlOiAnZXJyb3IgbWVzc2FnZSAyJyB9KTtcbiAgICAgIHdhcm5pbmcoeyBtZXNzYWdlOiAnd2FybmluZyBtZXNzYWdlIDInIH0pO1xuICAgICAgaW5mbyh7IG1lc3NhZ2U6ICdwcmludCBtZXNzYWdlIDInIH0pO1xuXG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2Vycm9yIG1lc3NhZ2VcXG4nKTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnZXJyb3IgbWVzc2FnZSAyXFxuJyk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikubm90LnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd3YXJuaW5nIG1lc3NhZ2VcXG4nKTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS5ub3QudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3dhcm5pbmcgbWVzc2FnZSAyXFxuJyk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikubm90LnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdwcmludCBtZXNzYWdlXFxuJyk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikubm90LnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdwcmludCBtZXNzYWdlIDJcXG4nKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2RlYnVnIG1lc3NhZ2VzIG9ubHkgc2hvdyBhdCBkZWJ1ZyBsZXZlbCB3aXRoIGJvdGggc3R5bGVzJywgKCkgPT4ge1xuICAgICAgc2V0SW9NZXNzYWdlVGhyZXNob2xkKCdpbmZvJyk7XG4gICAgICBkZWJ1ZygnZGVidWcgbWVzc2FnZScpO1xuICAgICAgZGVidWcoeyBtZXNzYWdlOiAnZGVidWcgbWVzc2FnZSAyJyB9KTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuXG4gICAgICBzZXRJb01lc3NhZ2VUaHJlc2hvbGQoJ2RlYnVnJyk7XG4gICAgICBkZWJ1ZygnZGVidWcgbWVzc2FnZScpO1xuICAgICAgZGVidWcoeyBtZXNzYWdlOiAnZGVidWcgbWVzc2FnZSAyJyB9KTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LnN0cmluZ01hdGNoaW5nKC9eXFxbXFxkezJ9OlxcZHsyfTpcXGR7Mn1cXF0gZGVidWcgbWVzc2FnZVxcbiQvKSxcbiAgICAgICk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5zdHJpbmdNYXRjaGluZygvXlxcW1xcZHsyfTpcXGR7Mn06XFxkezJ9XFxdIGRlYnVnIG1lc3NhZ2UgMlxcbiQvKSxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCd0cmFjZSBtZXNzYWdlcyBvbmx5IHNob3cgYXQgdHJhY2UgbGV2ZWwgd2l0aCBib3RoIHN0eWxlcycsICgpID0+IHtcbiAgICAgIHNldElvTWVzc2FnZVRocmVzaG9sZCgnZGVidWcnKTtcbiAgICAgIHRyYWNlKCd0cmFjZSBtZXNzYWdlJyk7XG4gICAgICB0cmFjZSh7IG1lc3NhZ2U6ICd0cmFjZSBtZXNzYWdlIDInIH0pO1xuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG5cbiAgICAgIHNldElvTWVzc2FnZVRocmVzaG9sZCgndHJhY2UnKTtcbiAgICAgIHRyYWNlKCd0cmFjZSBtZXNzYWdlJyk7XG4gICAgICB0cmFjZSh7IG1lc3NhZ2U6ICd0cmFjZSBtZXNzYWdlIDInIH0pO1xuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Quc3RyaW5nTWF0Y2hpbmcoL15cXFtcXGR7Mn06XFxkezJ9OlxcZHsyfVxcXSB0cmFjZSBtZXNzYWdlXFxuJC8pLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LnN0cmluZ01hdGNoaW5nKC9eXFxbXFxkezJ9OlxcZHsyfTpcXGR7Mn1cXF0gdHJhY2UgbWVzc2FnZSAyXFxuJC8pLFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2Zvcm1hdHRlZCBtZXNzYWdlcycsICgpID0+IHtcbiAgICB0ZXN0KCdoYW5kbGVzIGZvcm1hdCBzdHJpbmdzIGNvcnJlY3RseSB3aXRoIGJvdGggc3R5bGVzJywgKCkgPT4ge1xuICAgICAgLy8gU3RyaW5nIHN0eWxlXG4gICAgICBpbmZvKCdIZWxsbyAlcywgeW91IGhhdmUgJWQgbWVzc2FnZXMnLCAnVXNlcicsIDUpO1xuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdIZWxsbyBVc2VyLCB5b3UgaGF2ZSA1IG1lc3NhZ2VzXFxuJyk7XG5cbiAgICAgIC8vIE9iamVjdCBzdHlsZVxuICAgICAgaW5mbyh7IG1lc3NhZ2U6ICdIZWxsbyAlcywgeW91IGhhdmUgJWQgbWVzc2FnZXMnIH0sICdVc2VyJywgNSk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ0hlbGxvIFVzZXIsIHlvdSBoYXZlIDUgbWVzc2FnZXNcXG4nKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2hhbmRsZXMgb2JqZWN0cyBpbiBmb3JtYXQgc3RyaW5ncyB3aXRoIGJvdGggc3R5bGVzJywgKCkgPT4ge1xuICAgICAgY29uc3Qgb2JqID0geyBuYW1lOiAndGVzdCcgfTtcbiAgICAgIC8vIFN0cmluZyBzdHlsZVxuICAgICAgaW5mbygnT2JqZWN0OiAlaicsIG9iaik7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ09iamVjdDoge1wibmFtZVwiOlwidGVzdFwifVxcbicpO1xuXG4gICAgICAvLyBPYmplY3Qgc3R5bGVcbiAgICAgIGluZm8oeyBtZXNzYWdlOiAnT2JqZWN0OiAlaicgfSwgb2JqKTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnT2JqZWN0OiB7XCJuYW1lXCI6XCJ0ZXN0XCJ9XFxuJyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdoYW5kbGVzIG11bHRpcGxlIHN0eWxlIGNoYW5nZXMgaW4gc2luZ2xlIGNhbGwnLCAoKSA9PiB7XG4gICAgICBjb25zdCBvYmogPSB7IGlkOiAxMjMgfTtcbiAgICAgIHN1Y2Nlc3MoJ1Byb2Nlc3NpbmcgJXM6ICVqIGF0ICVkJSUnLCAndGFzaycsIG9iaiwgNTApO1xuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnUHJvY2Vzc2luZyB0YXNrOiB7XCJpZFwiOjEyM30gYXQgNTAlXFxuJyxcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzdHlsZWQgb3V0cHV0JywgKCkgPT4ge1xuICAgIHRlc3QoJ3N1Y2Nlc3MoKSBhZGRzIGdyZWVuIGNvbG9yIHRvIG91dHB1dCB3aXRoIGJvdGggc3R5bGVzJywgKCkgPT4ge1xuICAgICAgLy8gU3RyaW5nIHN0eWxlXG4gICAgICBzdWNjZXNzKCdvcGVyYXRpb24gY29tcGxldGVkJyk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ29wZXJhdGlvbiBjb21wbGV0ZWRcXG4nKTtcblxuICAgICAgLy8gT2JqZWN0IHN0eWxlXG4gICAgICBzdWNjZXNzKHsgbWVzc2FnZTogJ29wZXJhdGlvbiBjb21wbGV0ZWQgMicgfSk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ29wZXJhdGlvbiBjb21wbGV0ZWQgMlxcbicpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnaGlnaGxpZ2h0KCkgYWRkcyBib2xkIGZvcm1hdHRpbmcgdG8gb3V0cHV0IHdpdGggYm90aCBzdHlsZXMnLCAoKSA9PiB7XG4gICAgICAvLyBTdHJpbmcgc3R5bGVcbiAgICAgIGhpZ2hsaWdodCgnaW1wb3J0YW50IG1lc3NhZ2UnKTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaW1wb3J0YW50IG1lc3NhZ2VcXG4nKTtcblxuICAgICAgLy8gT2JqZWN0IHN0eWxlXG4gICAgICBoaWdobGlnaHQoeyBtZXNzYWdlOiAnaW1wb3J0YW50IG1lc3NhZ2UgMicgfSk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2ltcG9ydGFudCBtZXNzYWdlIDJcXG4nKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3N1Y2Nlc3MgaGFuZGxlcyBmb3JtYXQgc3RyaW5ncyB3aXRoIHN0eWxpbmcnLCAoKSA9PiB7XG4gICAgICBzdWNjZXNzKCdjb21wbGV0ZWQgdGFzayAlZCBvZiAlZCcsIDEsIDMpO1xuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdjb21wbGV0ZWQgdGFzayAxIG9mIDNcXG4nKTtcblxuICAgICAgLy8gUmVtb3ZlIHRoZSBjb2RlIGZyb20gdGhlIHRlc3Qgc2luY2UgaXQncyBhbiBpbXBsZW1lbnRhdGlvbiBkZXRhaWxcbiAgICAgIHN1Y2Nlc3MoeyBtZXNzYWdlOiAnY29tcGxldGVkIHRhc2sgJWQgb2YgJWQnIH0sIDIsIDMpO1xuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdjb21wbGV0ZWQgdGFzayAyIG9mIDNcXG4nKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2hpZ2hsaWdodCBoYW5kbGVzIGNvbXBsZXggb2JqZWN0cyB3aXRoIHN0eWxpbmcnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb21wbGV4T2JqID0geyBzdGF0dXM6ICdhY3RpdmUnLCBjb3VudDogNDIgfTtcbiAgICAgIGhpZ2hsaWdodCgnU3RhdHVzOiAlaicsIGNvbXBsZXhPYmopO1xuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdTdGF0dXM6IHtcInN0YXR1c1wiOlwiYWN0aXZlXCIsXCJjb3VudFwiOjQyfVxcbicpO1xuXG4gICAgICAvLyBSZW1vdmUgdGhlIGNvZGUgZnJvbSB0aGUgdGVzdCBzaW5jZSBpdCdzIGFuIGltcGxlbWVudGF0aW9uIGRldGFpbFxuICAgICAgaGlnaGxpZ2h0KHsgbWVzc2FnZTogJ1N0YXR1czogJWonIH0sIGNvbXBsZXhPYmopO1xuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdTdGF0dXM6IHtcInN0YXR1c1wiOlwiYWN0aXZlXCIsXCJjb3VudFwiOjQyfVxcbicpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZWRnZSBjYXNlcycsICgpID0+IHtcbiAgICB0ZXN0KCdoYW5kbGVzIG51bGwgYW5kIHVuZGVmaW5lZCBhcmd1bWVudHMgd2l0aCBib3RoIHN0eWxlcycsICgpID0+IHtcbiAgICAgIC8vIFN0cmluZyBzdHlsZVxuICAgICAgaW5mbygnVmFsdWVzOiAlcywgJXMnLCBudWxsLCB1bmRlZmluZWQpO1xuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdWYWx1ZXM6IG51bGwsIHVuZGVmaW5lZFxcbicpO1xuXG4gICAgICAvLyBPYmplY3Qgc3R5bGVcbiAgICAgIGluZm8oeyBtZXNzYWdlOiAnVmFsdWVzOiAlcywgJXMnIH0sIG51bGwsIHVuZGVmaW5lZCk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1ZhbHVlczogbnVsbCwgdW5kZWZpbmVkXFxuJyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdoYW5kbGVzIGNpcmN1bGFyIHJlZmVyZW5jZXMgaW4gb2JqZWN0cyB3aXRoIGJvdGggc3R5bGVzJywgKCkgPT4ge1xuICAgICAgY29uc3Qgb2JqOiBhbnkgPSB7IG5hbWU6ICd0ZXN0JyB9O1xuICAgICAgb2JqLnNlbGYgPSBvYmo7XG5cbiAgICAgIC8vIFN0cmluZyBzdHlsZVxuICAgICAgaW5mbygnT2JqZWN0OiAlaicsIG9iaik7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ1tDaXJjdWxhcicpKTtcblxuICAgICAgLy8gT2JqZWN0IHN0eWxlXG4gICAgICBpbmZvKHsgbWVzc2FnZTogJ09iamVjdDogJWonIH0sIG9iaik7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ1tDaXJjdWxhcicpKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ21lc3NhZ2UgY29kZXMnLCAoKSA9PiB7XG4gICAgdGVzdCgndmFsaWRhdGVzIG1lc3NhZ2UgY29kZXMgY29ycmVjdGx5JywgKCkgPT4ge1xuICAgICAgLy8gVmFsaWQgY29kZXNcbiAgICAgIGV4cGVjdCgoKSA9PiBlcnJvcih7IG1lc3NhZ2U6ICd0ZXN0JywgY29kZTogJ0NES19UT09MS0lUX0UwMDAxJyB9KSkubm90LnRvVGhyb3coKTtcbiAgICAgIGV4cGVjdCgoKSA9PiB3YXJuaW5nKHsgbWVzc2FnZTogJ3Rlc3QnLCBjb2RlOiAnQ0RLX0FTU0VUU19XNDk5OScgfSkpLm5vdC50b1Rocm93KCk7XG4gICAgICBleHBlY3QoKCkgPT4gaW5mbyh7IG1lc3NhZ2U6ICd0ZXN0JywgY29kZTogJ0NES19TREtfSTAwMDAnIH0pKS5ub3QudG9UaHJvdygpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgndXNlcyBkZWZhdWx0IGNvZGVzIHdoZW4gbm9uZSBwcm92aWRlZCcsICgpID0+IHtcbiAgICAgIGVycm9yKCd0ZXN0IGVycm9yJyk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ3Rlc3QgZXJyb3InKSk7XG4gICAgICAvLyBXb3VsZCBuZWVkIHRvIG1vZGlmeSB0aGUgY29kZSB0byBleHBvc2UgdGhlIGFjdHVhbCBtZXNzYWdlIGNvZGUgZm9yIHZlcmlmaWNhdGlvblxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY29ya2VkIGxvZ2dpbmcnLCAoKSA9PiB7XG4gICAgdGVzdCgnYnVmZmVycyBtZXNzYWdlcyB3aGVuIGNvcmtlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHdpdGhDb3JrZWRMb2dnaW5nKGFzeW5jICgpID0+IHtcbiAgICAgICAgaW5mbygnbWVzc2FnZSAxJyk7XG4gICAgICAgIGluZm8oeyBtZXNzYWdlOiAnbWVzc2FnZSAyJyB9KTtcbiAgICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdtZXNzYWdlIDFcXG4nKTtcbiAgICAgIGV4cGVjdChtb2NrU3RkZXJyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnbWVzc2FnZSAyXFxuJyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdoYW5kbGVzIG5lc3RlZCBjb3JraW5nIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHdpdGhDb3JrZWRMb2dnaW5nKGFzeW5jICgpID0+IHtcbiAgICAgICAgaW5mbygnb3V0ZXIgMScpO1xuICAgICAgICBhd2FpdCB3aXRoQ29ya2VkTG9nZ2luZyhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgaW5mbyh7IG1lc3NhZ2U6ICdpbm5lcicgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBpbmZvKHsgbWVzc2FnZTogJ291dGVyIDInIH0pO1xuICAgICAgICBleHBlY3QobW9ja1N0ZGVycikubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDMpO1xuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdvdXRlciAxXFxuJyk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2lubmVyXFxuJyk7XG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ291dGVyIDJcXG4nKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2hhbmRsZXMgZXJyb3JzIGluIGNvcmtlZCBibG9jayB3aGlsZSBwcmVzZXJ2aW5nIGJ1ZmZlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGV4cGVjdCh3aXRoQ29ya2VkTG9nZ2luZyhhc3luYyAoKSA9PiB7XG4gICAgICAgIGluZm8oJ21lc3NhZ2UgMScpO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3Rlc3QgZXJyb3InKTtcbiAgICAgIH0pKS5yZWplY3RzLnRvVGhyb3coJ3Rlc3QgZXJyb3InKTtcblxuICAgICAgLy8gVGhlIGJ1ZmZlcmVkIG1lc3NhZ2Ugc2hvdWxkIHN0aWxsIGJlIHByaW50ZWQgZXZlbiBpZiB0aGUgYmxvY2sgdGhyb3dzXG4gICAgICBleHBlY3QobW9ja1N0ZGVycikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ21lc3NhZ2UgMVxcbicpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnbWFpbnRhaW5zIGNvcnJlY3Qgb3JkZXIgd2l0aCBtaXhlZCBsb2cgbGV2ZWxzIGluIGNvcmtlZCBibG9jaycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFNldCB0aHJlc2hvbGQgdG8gZGVidWcgdG8gYWxsb3cgZGVidWcgbWVzc2FnZXNcbiAgICAgIHNldElvTWVzc2FnZVRocmVzaG9sZCgnZGVidWcnKTtcblxuICAgICAgYXdhaXQgd2l0aENvcmtlZExvZ2dpbmcoYXN5bmMgKCkgPT4ge1xuICAgICAgICBlcnJvcignZXJyb3IgbWVzc2FnZScpO1xuICAgICAgICB3YXJuaW5nKCd3YXJuaW5nIG1lc3NhZ2UnKTtcbiAgICAgICAgc3VjY2Vzcygnc3VjY2VzcyBtZXNzYWdlJyk7XG4gICAgICAgIGRlYnVnKCdkZWJ1ZyBtZXNzYWdlJyk7XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgY2FsbHMgPSBtb2NrU3RkZXJyLm1vY2suY2FsbHMubWFwKGNhbGwgPT4gY2FsbFswXSk7XG4gICAgICBleHBlY3QoY2FsbHMpLnRvRXF1YWwoW1xuICAgICAgICAnZXJyb3IgbWVzc2FnZVxcbicsXG4gICAgICAgICd3YXJuaW5nIG1lc3NhZ2VcXG4nLFxuICAgICAgICAnc3VjY2VzcyBtZXNzYWdlXFxuJyxcbiAgICAgICAgZXhwZWN0LnN0cmluZ01hdGNoaW5nKC9eXFxbXFxkezJ9OlxcZHsyfTpcXGR7Mn1cXF0gZGVidWcgbWVzc2FnZVxcbiQvKSxcbiAgICAgIF0pO1xuXG4gICAgICAvLyBSZXNldCB0aHJlc2hvbGQgYmFjayB0byBpbmZvIGZvciBvdGhlciB0ZXN0c1xuICAgICAgc2V0SW9NZXNzYWdlVGhyZXNob2xkKCdpbmZvJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdDSSBtb2RlIGJlaGF2aW9yJywgKCkgPT4ge1xuICAgIHRlc3QoJ2NvcnJlY3RseSBzd2l0Y2hlcyBiZXR3ZWVuIHN0ZG91dCBhbmQgc3RkZXJyIGJhc2VkIG9uIENJIG1vZGUnLCAoKSA9PiB7XG4gICAgICBzZXRDSSh0cnVlKTtcbiAgICAgIHdhcm5pbmcoJ3dhcm5pbmcgaW4gQ0knKTtcbiAgICAgIHN1Y2Nlc3MoJ3N1Y2Nlc3MgaW4gQ0knKTtcbiAgICAgIGVycm9yKCdlcnJvciBpbiBDSScpO1xuXG4gICAgICBleHBlY3QobW9ja1N0ZG91dCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3dhcm5pbmcgaW4gQ0lcXG4nKTtcbiAgICAgIGV4cGVjdChtb2NrU3Rkb3V0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnc3VjY2VzcyBpbiBDSVxcbicpO1xuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdlcnJvciBpbiBDSVxcbicpO1xuXG4gICAgICBzZXRDSShmYWxzZSk7XG4gICAgICB3YXJuaW5nKCd3YXJuaW5nIG5vdCBpbiBDSScpO1xuICAgICAgc3VjY2Vzcygnc3VjY2VzcyBub3QgaW4gQ0knKTtcbiAgICAgIGVycm9yKCdlcnJvciBub3QgaW4gQ0knKTtcblxuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd3YXJuaW5nIG5vdCBpbiBDSVxcbicpO1xuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdzdWNjZXNzIG5vdCBpbiBDSVxcbicpO1xuICAgICAgZXhwZWN0KG1vY2tTdGRlcnIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdlcnJvciBub3QgaW4gQ0lcXG4nKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==