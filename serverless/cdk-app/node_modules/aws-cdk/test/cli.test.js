"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const cli_1 = require("../lib/cli");
const logging_1 = require("../lib/logging");
// Store original version module exports so we don't conflict with other tests
const originalVersion = jest.requireActual('../lib/version');
// Mock the dependencies
jest.mock('../lib/logging', () => ({
    LogLevel: {
        DEBUG: 'DEBUG',
        TRACE: 'TRACE',
    },
    setIoMessageThreshold: jest.fn(),
    debug: jest.fn(),
    error: jest.fn(),
    print: jest.fn(),
    data: jest.fn(),
}));
jest.mock('@aws-cdk/cx-api');
jest.mock('@jsii/check-node/run');
jest.mock('../lib/platform-warnings', () => ({
    checkForPlatformWarnings: jest.fn().mockResolvedValue(undefined),
}));
jest.mock('../lib/settings', () => ({
    Configuration: jest.fn().mockImplementation(() => ({
        load: jest.fn().mockResolvedValue(undefined),
        settings: {
            get: jest.fn().mockReturnValue(undefined),
        },
        context: {
            get: jest.fn().mockReturnValue([]),
        },
    })),
}));
jest.mock('../lib/notices', () => ({
    Notices: {
        create: jest.fn().mockReturnValue({
            refresh: jest.fn().mockResolvedValue(undefined),
            display: jest.fn(),
        }),
    },
}));
jest.mock('../lib/parse-command-line-arguments', () => ({
    parseCommandLineArguments: jest.fn().mockImplementation((args) => Promise.resolve({
        _: ['version'],
        verbose: args.includes('-v') ? (args.filter((arg) => arg === '-v').length) : args.includes('--verbose') ? (parseInt(args[args.indexOf('--verbose') + 1]) || true) : undefined,
    })),
}));
describe('exec verbose flag tests', () => {
    beforeEach(() => {
        jest.clearAllMocks();
        // Set up version module for our tests
        jest.mock('../lib/version', () => ({
            ...originalVersion,
            DISPLAY_VERSION: 'test-version',
            displayVersionMessage: jest.fn().mockResolvedValue(undefined),
        }));
    });
    afterEach(() => {
        // Restore the version module to its original state
        jest.resetModules();
        jest.setMock('../lib/version', originalVersion);
    });
    test('should not set log level when no verbose flag is present', async () => {
        await (0, cli_1.exec)(['version']);
        expect(logging_1.setIoMessageThreshold).not.toHaveBeenCalled();
    });
    test('should set DEBUG level with single -v flag', async () => {
        await (0, cli_1.exec)(['-v', 'version']);
        expect(logging_1.setIoMessageThreshold).toHaveBeenCalledWith('debug');
    });
    test('should set TRACE level with double -v flag', async () => {
        await (0, cli_1.exec)(['-v', '-v', 'version']);
        expect(logging_1.setIoMessageThreshold).toHaveBeenCalledWith('trace');
    });
    test('should set DEBUG level with --verbose=1', async () => {
        await (0, cli_1.exec)(['--verbose', '1', 'version']);
        expect(logging_1.setIoMessageThreshold).toHaveBeenCalledWith('debug');
    });
    test('should set TRACE level with --verbose=2', async () => {
        await (0, cli_1.exec)(['--verbose', '2', 'version']);
        expect(logging_1.setIoMessageThreshold).toHaveBeenCalledWith('trace');
    });
    test('should set TRACE level with verbose level > 2', async () => {
        await (0, cli_1.exec)(['--verbose', '3', 'version']);
        expect(logging_1.setIoMessageThreshold).toHaveBeenCalledWith('trace');
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjbGkudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLG9DQUFrQztBQUNsQyw0Q0FBdUQ7QUFFdkQsOEVBQThFO0FBQzlFLE1BQU0sZUFBZSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztBQUU3RCx3QkFBd0I7QUFDeEIsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ2pDLFFBQVEsRUFBRTtRQUNSLEtBQUssRUFBRSxPQUFPO1FBQ2QsS0FBSyxFQUFFLE9BQU87S0FDZjtJQUNELHFCQUFxQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDaEMsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDaEIsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDaEIsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDaEIsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Q0FDaEIsQ0FBQyxDQUFDLENBQUM7QUFFSixJQUFJLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUM7QUFDN0IsSUFBSSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0FBQ2xDLElBQUksQ0FBQyxJQUFJLENBQUMsMEJBQTBCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUMzQyx3QkFBd0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDO0NBQ2pFLENBQUMsQ0FBQyxDQUFDO0FBRUosSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ2xDLGFBQWEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsa0JBQWtCLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNqRCxJQUFJ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aWIvY2xpJztcbmltcG9ydCB7IHNldElvTWVzc2FnZVRocmVzaG9sZCB9IGZyb20gJy4uL2xpYi9sb2dnaW5nJztcblxuLy8gU3RvcmUgb3JpZ2luYWwgdmVyc2lvbiBtb2R1bGUgZXhwb3J0cyBzbyB3ZSBkb24ndCBjb25mbGljdCB3aXRoIG90aGVyIHRlc3RzXG5jb25zdCBvcmlnaW5hbFZlcnNpb24gPSBqZXN0LnJlcXVpcmVBY3R1YWwoJy4uL2xpYi92ZXJzaW9uJyk7XG5cbi8vIE1vY2sgdGhlIGRlcGVuZGVuY2llc1xuamVzdC5tb2NrKCcuLi9saWIvbG9nZ2luZycsICgpID0+ICh7XG4gIExvZ0xldmVsOiB7XG4gICAgREVCVUc6ICdERUJVRycsXG4gICAgVFJBQ0U6ICdUUkFDRScsXG4gIH0sXG4gIHNldElvTWVzc2FnZVRocmVzaG9sZDogamVzdC5mbigpLFxuICBkZWJ1ZzogamVzdC5mbigpLFxuICBlcnJvcjogamVzdC5mbigpLFxuICBwcmludDogamVzdC5mbigpLFxuICBkYXRhOiBqZXN0LmZuKCksXG59KSk7XG5cbmplc3QubW9jaygnQGF3cy1jZGsvY3gtYXBpJyk7XG5qZXN0Lm1vY2soJ0Bqc2lpL2NoZWNrLW5vZGUvcnVuJyk7XG5qZXN0Lm1vY2soJy4uL2xpYi9wbGF0Zm9ybS13YXJuaW5ncycsICgpID0+ICh7XG4gIGNoZWNrRm9yUGxhdGZvcm1XYXJuaW5nczogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCksXG59KSk7XG5cbmplc3QubW9jaygnLi4vbGliL3NldHRpbmdzJywgKCkgPT4gKHtcbiAgQ29uZmlndXJhdGlvbjogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgIGxvYWQ6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpLFxuICAgIHNldHRpbmdzOiB7XG4gICAgICBnZXQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUodW5kZWZpbmVkKSxcbiAgICB9LFxuICAgIGNvbnRleHQ6IHtcbiAgICAgIGdldDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShbXSksXG4gICAgfSxcbiAgfSkpLFxufSkpO1xuXG5qZXN0Lm1vY2soJy4uL2xpYi9ub3RpY2VzJywgKCkgPT4gKHtcbiAgTm90aWNlczoge1xuICAgIGNyZWF0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICByZWZyZXNoOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKSxcbiAgICAgIGRpc3BsYXk6IGplc3QuZm4oKSxcbiAgICB9KSxcbiAgfSxcbn0pKTtcblxuamVzdC5tb2NrKCcuLi9saWIvcGFyc2UtY29tbWFuZC1saW5lLWFyZ3VtZW50cycsICgpID0+ICh7XG4gIHBhcnNlQ29tbWFuZExpbmVBcmd1bWVudHM6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKGFyZ3MpID0+IFByb21pc2UucmVzb2x2ZSh7XG4gICAgXzogWyd2ZXJzaW9uJ10sXG4gICAgdmVyYm9zZTogYXJncy5pbmNsdWRlcygnLXYnKSA/IChcbiAgICAgIGFyZ3MuZmlsdGVyKChhcmc6IHN0cmluZykgPT4gYXJnID09PSAnLXYnKS5sZW5ndGhcbiAgICApIDogYXJncy5pbmNsdWRlcygnLS12ZXJib3NlJykgPyAoXG4gICAgICBwYXJzZUludChhcmdzW2FyZ3MuaW5kZXhPZignLS12ZXJib3NlJykgKyAxXSkgfHwgdHJ1ZVxuICAgICkgOiB1bmRlZmluZWQsXG4gIH0pKSxcbn0pKTtcblxuZGVzY3JpYmUoJ2V4ZWMgdmVyYm9zZSBmbGFnIHRlc3RzJywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICAvLyBTZXQgdXAgdmVyc2lvbiBtb2R1bGUgZm9yIG91ciB0ZXN0c1xuICAgIGplc3QubW9jaygnLi4vbGliL3ZlcnNpb24nLCAoKSA9PiAoe1xuICAgICAgLi4ub3JpZ2luYWxWZXJzaW9uLFxuICAgICAgRElTUExBWV9WRVJTSU9OOiAndGVzdC12ZXJzaW9uJyxcbiAgICAgIGRpc3BsYXlWZXJzaW9uTWVzc2FnZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCksXG4gICAgfSkpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIC8vIFJlc3RvcmUgdGhlIHZlcnNpb24gbW9kdWxlIHRvIGl0cyBvcmlnaW5hbCBzdGF0ZVxuICAgIGplc3QucmVzZXRNb2R1bGVzKCk7XG4gICAgamVzdC5zZXRNb2NrKCcuLi9saWIvdmVyc2lvbicsIG9yaWdpbmFsVmVyc2lvbik7XG4gIH0pO1xuXG4gIHRlc3QoJ3Nob3VsZCBub3Qgc2V0IGxvZyBsZXZlbCB3aGVuIG5vIHZlcmJvc2UgZmxhZyBpcyBwcmVzZW50JywgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGV4ZWMoWyd2ZXJzaW9uJ10pO1xuICAgIGV4cGVjdChzZXRJb01lc3NhZ2VUaHJlc2hvbGQpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Nob3VsZCBzZXQgREVCVUcgbGV2ZWwgd2l0aCBzaW5nbGUgLXYgZmxhZycsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBleGVjKFsnLXYnLCAndmVyc2lvbiddKTtcbiAgICBleHBlY3Qoc2V0SW9NZXNzYWdlVGhyZXNob2xkKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnZGVidWcnKTtcbiAgfSk7XG5cbiAgdGVzdCgnc2hvdWxkIHNldCBUUkFDRSBsZXZlbCB3aXRoIGRvdWJsZSAtdiBmbGFnJywgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGV4ZWMoWyctdicsICctdicsICd2ZXJzaW9uJ10pO1xuICAgIGV4cGVjdChzZXRJb01lc3NhZ2VUaHJlc2hvbGQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd0cmFjZScpO1xuICB9KTtcblxuICB0ZXN0KCdzaG91bGQgc2V0IERFQlVHIGxldmVsIHdpdGggLS12ZXJib3NlPTEnLCBhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgZXhlYyhbJy0tdmVyYm9zZScsICcxJywgJ3ZlcnNpb24nXSk7XG4gICAgZXhwZWN0KHNldElvTWVzc2FnZVRocmVzaG9sZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2RlYnVnJyk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Nob3VsZCBzZXQgVFJBQ0UgbGV2ZWwgd2l0aCAtLXZlcmJvc2U9MicsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBleGVjKFsnLS12ZXJib3NlJywgJzInLCAndmVyc2lvbiddKTtcbiAgICBleHBlY3Qoc2V0SW9NZXNzYWdlVGhyZXNob2xkKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndHJhY2UnKTtcbiAgfSk7XG5cbiAgdGVzdCgnc2hvdWxkIHNldCBUUkFDRSBsZXZlbCB3aXRoIHZlcmJvc2UgbGV2ZWwgPiAyJywgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGV4ZWMoWyctLXZlcmJvc2UnLCAnMycsICd2ZXJzaW9uJ10pO1xuICAgIGV4cGVjdChzZXRJb01lc3NhZ2VUaHJlc2hvbGQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd0cmFjZScpO1xuICB9KTtcbn0pO1xuIl19