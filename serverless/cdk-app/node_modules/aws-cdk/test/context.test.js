"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/* eslint-disable import/order */
const os = require("os");
const path = require("path");
const fs = require("fs-extra");
const settings_1 = require("../lib/settings");
const state = {};
beforeEach(async () => {
    state.previousWorkingDir = process.cwd();
    state.tempDir = await fs.mkdtemp(path.join(os.tmpdir(), 'aws-cdk-test'));
    // eslint-disable-next-line no-console
    console.log('Temporary working directory:', state.tempDir);
    process.chdir(state.tempDir);
});
afterEach(async () => {
    // eslint-disable-next-line no-console
    console.log('Switching back to', state.previousWorkingDir, 'cleaning up', state.tempDir);
    process.chdir(state.previousWorkingDir);
    await fs.remove(state.tempDir);
});
test('load context from both files if available', async () => {
    // GIVEN
    await fs.writeJSON(settings_1.PROJECT_CONTEXT, { foo: 'bar' });
    await fs.writeJSON(settings_1.PROJECT_CONFIG, { context: { boo: 'far' } });
    // WHEN
    const config = await new settings_1.Configuration({ readUserContext: false }).load();
    // THEN
    expect(config.context.get('foo')).toBe('bar');
    expect(config.context.get('boo')).toBe('far');
});
test('deleted context disappears from new file', async () => {
    // GIVEN
    await fs.writeJSON(settings_1.PROJECT_CONTEXT, { foo: 'bar' });
    await fs.writeJSON(settings_1.PROJECT_CONFIG, { context: { foo: 'bar' } });
    const config = await new settings_1.Configuration({ readUserContext: false }).load();
    // WHEN
    config.context.unset('foo');
    await config.context.save(settings_1.PROJECT_CONTEXT);
    // THEN
    expect(await fs.readJSON(settings_1.PROJECT_CONTEXT)).toEqual({});
    expect(await fs.readJSON(settings_1.PROJECT_CONFIG)).toEqual({ context: { foo: 'bar' } });
});
test('clear deletes from new file', async () => {
    // GIVEN
    await fs.writeJSON(settings_1.PROJECT_CONTEXT, { foo: 'bar' });
    await fs.writeJSON(settings_1.PROJECT_CONFIG, { context: { boo: 'far' } });
    const config = await new settings_1.Configuration({ readUserContext: false }).load();
    // WHEN
    config.context.clear();
    await config.context.save(settings_1.PROJECT_CONTEXT);
    // THEN
    expect(await fs.readJSON(settings_1.PROJECT_CONTEXT)).toEqual({});
    expect(await fs.readJSON(settings_1.PROJECT_CONFIG)).toEqual({ context: { boo: 'far' } });
});
test('context is preserved in the location from which it is read', async () => {
    // GIVEN
    await fs.writeJSON(settings_1.PROJECT_CONFIG, { context: { 'boo:boo': 'far' } });
    const config = await new settings_1.Configuration({ readUserContext: false }).load();
    // WHEN
    expect(config.context.all).toEqual({ 'boo:boo': 'far' });
    await config.context.save(settings_1.PROJECT_CONTEXT);
    // THEN
    expect(await fs.readJSON(settings_1.PROJECT_CONTEXT)).toEqual({});
    expect(await fs.readJSON(settings_1.PROJECT_CONFIG)).toEqual({ context: { 'boo:boo': 'far' } });
});
test('save no context in old file', async () => {
    // GIVEN
    await fs.writeJSON(settings_1.PROJECT_CONFIG, {});
    await fs.writeJSON(settings_1.PROJECT_CONTEXT, { boo: 'far' });
    const config = await new settings_1.Configuration({ readUserContext: false }).load();
    // WHEN
    expect(config.context.all).toEqual({ boo: 'far' });
    await config.context.save(settings_1.PROJECT_CONTEXT);
    // THEN
    expect(await fs.readJSON(settings_1.PROJECT_CONTEXT)).toEqual({ boo: 'far' });
});
test('command line context is merged with stored context', async () => {
    // GIVEN
    await fs.writeJSON(settings_1.PROJECT_CONTEXT, { boo: 'far' });
    const config = await new settings_1.Configuration({
        readUserContext: false,
        commandLineArguments: {
            context: ['foo=bar'],
            _: ['command'],
        },
    }).load();
    // WHEN
    expect(config.context.all).toEqual({ foo: 'bar', boo: 'far' });
});
test('can save and load', async () => {
    // GIVEN
    const config1 = await new settings_1.Configuration({ readUserContext: false }).load();
    config1.context.set('some_key', 'some_value');
    await config1.context.save(settings_1.PROJECT_CONTEXT);
    expect(config1.context.get('some_key')).toEqual('some_value');
    // WHEN
    const config2 = await new settings_1.Configuration({ readUserContext: false }).load();
    // THEN
    expect(config2.context.get('some_key')).toEqual('some_value');
});
test('transient values arent saved to disk', async () => {
    // GIVEN
    const config1 = await new settings_1.Configuration({ readUserContext: false }).load();
    config1.context.set('some_key', { [settings_1.TRANSIENT_CONTEXT_KEY]: true, value: 'some_value' });
    await config1.context.save(settings_1.PROJECT_CONTEXT);
    expect(config1.context.get('some_key').value).toEqual('some_value');
    // WHEN
    const config2 = await new settings_1.Configuration({ readUserContext: false }).load();
    // THEN
    expect(config2.context.get('some_key')).toEqual(undefined);
});
test('cannot save readonly values', async () => {
    // GIVEN
    const settings = new settings_1.Settings({ foo: 'bar', boo: 'far' }, true);
    const context = new settings_1.Context({
        fileName: settings_1.PROJECT_CONFIG,
        bag: settings,
    });
    // THEN
    await expect(context.save(settings_1.PROJECT_CONFIG)).rejects.toThrow(/Context file cdk.json is read only!/);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGV4dC50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY29udGV4dC50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsaUNBQWlDO0FBQ2pDLHlCQUF5QjtBQUN6Qiw2QkFBNkI7QUFDN0IsK0JBQStCO0FBQy9CLDhDQUEySDtBQUUzSCxNQUFNLEtBQUssR0FHUCxFQUFFLENBQUM7QUFFUCxVQUFVLENBQUMsS0FBSyxJQUFJLEVBQUU7SUFDcEIsS0FBSyxDQUFDLGtCQUFrQixHQUFHLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUN6QyxLQUFLLENBQUMsT0FBTyxHQUFHLE1BQU0sRUFBRSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsRUFBRSxjQUFjLENBQUMsQ0FBQyxDQUFDO0lBQ3pFLHNDQUFzQztJQUN0QyxPQUFPLENBQUMsR0FBRyxDQUFDLDhCQUE4QixFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUMzRCxPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUMvQixDQUFDLENBQUMsQ0FBQztBQUVILFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRTtJQUNuQixzQ0FBc0M7SUFDdEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsRUFBRSxLQUFLLENBQUMsa0JBQWtCLEVBQUUsYUFBYSxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN6RixPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxrQkFBbUIsQ0FBQyxDQUFDO0lBQ3pDLE1BQU0sRUFBRSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBUSxDQUFDLENBQUM7QUFDbEMsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsMkNBQTJDLEVBQUUsS0FBSyxJQUFJLEVBQUU7SUFDM0QsUUFBUTtJQUNSLE1BQU0sRUFBRSxDQUFDLFNBQVMsQ0FB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LE1BQU0sT0FBTyxHQUFHLE1BQU0sSUFBSSx3QkFBYSxDQUFDLEVBQUUsZUFBZSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7SUFFM0UsT0FBTztJQUNQLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUM3RCxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyw2QkFBNkIsRUFBRSxLQUFLLElBQUksRUFBRTtJQUM3QyxRQUFRO0lBQ1IsTUFBTSxRQUFRLEdBQUcsSUFBSSxtQkFBUSxDQUFDLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDaEUsTUFBTSxPQUFPLEdBQUcsSUFBSSxrQkFBTyxDQUFDO1FBQzFCLFFBQVEsRUFBRSx5QkFBYztRQUN4QixHQUFHLEVBQUUsUUFBUTtLQUNkLENBQUMsQ0FBQztJQUVILE9BQU87SUFDUCxNQUFNLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLHlCQUFjLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMscUNBQXFDLENBQUMsQ0FBQztBQUNwRyxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIGltcG9ydC9vcmRlciAqL1xuaW1wb3J0ICogYXMgb3MgZnJvbSAnb3MnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCB7IENvbmZpZ3VyYXRpb24sIENvbnRleHQsIFBST0pFQ1RfQ09ORklHLCBQUk9KRUNUX0NPTlRFWFQsIFNldHRpbmdzLCBUUkFOU0lFTlRfQ09OVEVYVF9LRVkgfSBmcm9tICcuLi9saWIvc2V0dGluZ3MnO1xuXG5jb25zdCBzdGF0ZToge1xuICBwcmV2aW91c1dvcmtpbmdEaXI/OiBzdHJpbmc7XG4gIHRlbXBEaXI/OiBzdHJpbmc7XG59ID0ge307XG5cbmJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICBzdGF0ZS5wcmV2aW91c1dvcmtpbmdEaXIgPSBwcm9jZXNzLmN3ZCgpO1xuICBzdGF0ZS50ZW1wRGlyID0gYXdhaXQgZnMubWtkdGVtcChwYXRoLmpvaW4ob3MudG1wZGlyKCksICdhd3MtY2RrLXRlc3QnKSk7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gIGNvbnNvbGUubG9nKCdUZW1wb3Jhcnkgd29ya2luZyBkaXJlY3Rvcnk6Jywgc3RhdGUudGVtcERpcik7XG4gIHByb2Nlc3MuY2hkaXIoc3RhdGUudGVtcERpcik7XG59KTtcblxuYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgY29uc29sZS5sb2coJ1N3aXRjaGluZyBiYWNrIHRvJywgc3RhdGUucHJldmlvdXNXb3JraW5nRGlyLCAnY2xlYW5pbmcgdXAnLCBzdGF0ZS50ZW1wRGlyKTtcbiAgcHJvY2Vzcy5jaGRpcihzdGF0ZS5wcmV2aW91c1dvcmtpbmdEaXIhKTtcbiAgYXdhaXQgZnMucmVtb3ZlKHN0YXRlLnRlbXBEaXIhKTtcbn0pO1xuXG50ZXN0KCdsb2FkIGNvbnRleHQgZnJvbSBib3RoIGZpbGVzIGlmIGF2YWlsYWJsZScsIGFzeW5jICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgYXdhaXQgZnMud3JpdGVKU09OKFBST0pFQ1RfQ09OVEVYVCwgeyBmb286ICdiYXInIH0pO1xuICBhd2FpdCBmcy53cml0ZUpTT04oUFJPSkVDVF9DT05GSUcsIHsgY29udGV4dDogeyBib286ICdmYXInIH0gfSk7XG5cbiAgLy8gV0hFTlxuICBjb25zdCBjb25maWcgPSBhd2FpdCBuZXcgQ29uZmlndXJhdGlvbih7IHJlYWRVc2VyQ29udGV4dDogZmFsc2UgfSkubG9hZCgpO1xuXG4gIC8vIFRIRU5cbiAgZXhwZWN0KGNvbmZpZy5jb250ZXh0LmdldCgnZm9vJykpLnRvQmUoJ2JhcicpO1xuICBleHBlY3QoY29uZmlnLmNvbnRleHQuZ2V0KCdib28nKSkudG9CZSgnZmFyJyk7XG59KTtcblxudGVzdCgnZGVsZXRlZCBjb250ZXh0IGRpc2FwcGVhcnMgZnJvbSBuZXcgZmlsZScsIGFzeW5jICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgYXdhaXQgZnMud3JpdGVKU09OKFBST0pFQ1RfQ09OVEVYVCwgeyBmb286ICdiYXInIH0pO1xuICBhd2FpdCBmcy53cml0ZUpTT04oUFJPSkVDVF9DT05GSUcsIHsgY29udGV4dDogeyBmb286ICdiYXInIH0gfSk7XG4gIGNvbnN0IGNvbmZpZyA9IGF3YWl0IG5ldyBDb25maWd1cmF0aW9uKHsgcmVhZFVzZXJDb250ZXh0OiBmYWxzZSB9KS5sb2FkKCk7XG5cbiAgLy8gV0hFTlxuICBjb25maWcuY29udGV4dC51bnNldCgnZm9vJyk7XG4gIGF3YWl0IGNvbmZpZy5jb250ZXh0LnNhdmUoUFJPSkVDVF9DT05URVhUKTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdChhd2FpdCBmcy5yZWFkSlNPTihQUk9KRUNUX0NPTlRFWFQpKS50b0VxdWFsKHt9KTtcbiAgZXhwZWN0KGF3YWl0IGZzLnJlYWRKU09OKFBST0pFQ1RfQ09ORklHKSkudG9FcXVhbCh7IGNvbnRleHQ6IHsgZm9vOiAnYmFyJyB9IH0pO1xufSk7XG5cbnRlc3QoJ2NsZWFyIGRlbGV0ZXMgZnJvbSBuZXcgZmlsZScsIGFzeW5jICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgYXdhaXQgZnMud3JpdGVKU09OKFBST0pFQ1RfQ09OVEVYVCwgeyBmb286ICdiYXInIH0pO1xuICBhd2FpdCBmcy53cml0ZUpTT04oUFJPSkVDVF9DT05GSUcsIHsgY29udGV4dDogeyBib286ICdmYXInIH0gfSk7XG4gIGNvbnN0IGNvbmZpZyA9IGF3YWl0IG5ldyBDb25maWd1cmF0aW9uKHsgcmVhZFVzZXJDb250ZXh0OiBmYWxzZSB9KS5sb2FkKCk7XG5cbiAgLy8gV0hFTlxuICBjb25maWcuY29udGV4dC5jbGVhcigpO1xuICBhd2FpdCBjb25maWcuY29udGV4dC5zYXZlKFBST0pFQ1RfQ09OVEVYVCk7XG5cbiAgLy8gVEhFTlxuICBleHBlY3QoYXdhaXQgZnMucmVhZEpTT04oUFJPSkVDVF9DT05URVhUKSkudG9FcXVhbCh7fSk7XG4gIGV4cGVjdChhd2FpdCBmcy5yZWFkSlNPTihQUk9KRUNUX0NPTkZJRykpLnRvRXF1YWwoeyBjb250ZXh0OiB7IGJvbzogJ2ZhcicgfSB9KTtcbn0pO1xuXG50ZXN0KCdjb250ZXh0IGlzIHByZXNlcnZlZCBpbiB0aGUgbG9jYXRpb24gZnJvbSB3aGljaCBpdCBpcyByZWFkJywgYXN5bmMgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBhd2FpdCBmcy53cml0ZUpTT04oUFJPSkVDVF9DT05GSUcsIHsgY29udGV4dDogeyAnYm9vOmJvbyc6ICdmYXInIH0gfSk7XG4gIGNvbnN0IGNvbmZpZyA9IGF3YWl0IG5ldyBDb25maWd1cmF0aW9uKHsgcmVhZFVzZXJDb250ZXh0OiBmYWxzZSB9KS5sb2FkKCk7XG5cbiAgLy8gV0hFTlxuICBleHBlY3QoY29uZmlnLmNvbnRleHQuYWxsKS50b0VxdWFsKHsgJ2Jvbzpib28nOiAnZmFyJyB9KTtcbiAgYXdhaXQgY29uZmlnLmNvbnRleHQuc2F2ZShQUk9KRUNUX0NPTlRFWFQpO1xuXG4gIC8vIFRIRU5cbiAgZXhwZWN0KGF3YWl0IGZzLnJlYWRKU09OKFBST0pFQ1RfQ09OVEVYVCkpLnRvRXF1YWwoe30pO1xuICBleHBlY3QoYXdhaXQgZnMucmVhZEpTT04oUFJPSkVDVF9DT05GSUcpKS50b0VxdWFsKHsgY29udGV4dDogeyAnYm9vOmJvbyc6ICdmYXInIH0gfSk7XG59KTtcblxudGVzdCgnc2F2ZSBubyBjb250ZXh0IGluIG9sZCBmaWxlJywgYXN5bmMgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBhd2FpdCBmcy53cml0ZUpTT04oUFJPSkVDVF9DT05GSUcsIHt9KTtcbiAgYXdhaXQgZnMud3JpdGVKU09OKFBST0pFQ1RfQ09OVEVYVCwgeyBib286ICdmYXInIH0pO1xuICBjb25zdCBjb25maWcgPSBhd2FpdCBuZXcgQ29uZmlndXJhdGlvbih7IHJlYWRVc2VyQ29udGV4dDogZmFsc2UgfSkubG9hZCgpO1xuXG4gIC8vIFdIRU5cbiAgZXhwZWN0KGNvbmZpZy5jb250ZXh0LmFsbCkudG9FcXVhbCh7IGJvbzogJ2ZhcicgfSk7XG4gIGF3YWl0IGNvbmZpZy5jb250ZXh0LnNhdmUoUFJPSkVDVF9DT05URVhUKTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdChhd2FpdCBmcy5yZWFkSlNPTihQUk9KRUNUX0NPTlRFWFQpKS50b0VxdWFsKHsgYm9vOiAnZmFyJyB9KTtcbn0pO1xuXG50ZXN0KCdjb21tYW5kIGxpbmUgY29udGV4dCBpcyBtZXJnZWQgd2l0aCBzdG9yZWQgY29udGV4dCcsIGFzeW5jICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgYXdhaXQgZnMud3JpdGVKU09OKFBST0pFQ1RfQ09OVEVYVCwgeyBib286ICdmYXInIH0pO1xuICBjb25zdCBjb25maWcgPSBhd2FpdCBuZXcgQ29uZmlndXJhdGlvbih7XG4gICAgcmVhZFVzZXJDb250ZXh0OiBmYWxzZSxcbiAgICBjb21tYW5kTGluZUFyZ3VtZW50czoge1xuICAgICAgY29udGV4dDogWydmb289YmFyJ10sXG4gICAgICBfOiBbJ2NvbW1hbmQnXSxcbiAgICB9IGFzIGFueSxcbiAgfSkubG9hZCgpO1xuXG4gIC8vIFdIRU5cbiAgZXhwZWN0KGNvbmZpZy5jb250ZXh0LmFsbCkudG9FcXVhbCh7IGZvbzogJ2JhcicsIGJvbzogJ2ZhcicgfSk7XG59KTtcblxudGVzdCgnY2FuIHNhdmUgYW5kIGxvYWQnLCBhc3luYyAoKSA9PiB7XG4gIC8vIEdJVkVOXG4gIGNvbnN0IGNvbmZpZzEgPSBhd2FpdCBuZXcgQ29uZmlndXJhdGlvbih7IHJlYWRVc2VyQ29udGV4dDogZmFsc2UgfSkubG9hZCgpO1xuICBjb25maWcxLmNvbnRleHQuc2V0KCdzb21lX2tleScsICdzb21lX3ZhbHVlJyk7XG4gIGF3YWl0IGNvbmZpZzEuY29udGV4dC5zYXZlKFBST0pFQ1RfQ09OVEVYVCk7XG4gIGV4cGVjdChjb25maWcxLmNvbnRleHQuZ2V0KCdzb21lX2tleScpKS50b0VxdWFsKCdzb21lX3ZhbHVlJyk7XG5cbiAgLy8gV0hFTlxuICBjb25zdCBjb25maWcyID0gYXdhaXQgbmV3IENvbmZpZ3VyYXRpb24oeyByZWFkVXNlckNvbnRleHQ6IGZhbHNlIH0pLmxvYWQoKTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdChjb25maWcyLmNvbnRleHQuZ2V0KCdzb21lX2tleScpKS50b0VxdWFsKCdzb21lX3ZhbHVlJyk7XG59KTtcblxudGVzdCgndHJhbnNpZW50IHZhbHVlcyBhcmVudCBzYXZlZCB0byBkaXNrJywgYXN5bmMgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBjb25zdCBjb25maWcxID0gYXdhaXQgbmV3IENvbmZpZ3VyYXRpb24oeyByZWFkVXNlckNvbnRleHQ6IGZhbHNlIH0pLmxvYWQoKTtcbiAgY29uZmlnMS5jb250ZXh0LnNldCgnc29tZV9rZXknLCB7IFtUUkFOU0lFTlRfQ09OVEVYVF9LRVldOiB0cnVlLCB2YWx1ZTogJ3NvbWVfdmFsdWUnIH0pO1xuICBhd2FpdCBjb25maWcxLmNvbnRleHQuc2F2ZShQUk9KRUNUX0NPTlRFWFQpO1xuICBleHBlY3QoY29uZmlnMS5jb250ZXh0LmdldCgnc29tZV9rZXknKS52YWx1ZSkudG9FcXVhbCgnc29tZV92YWx1ZScpO1xuXG4gIC8vIFdIRU5cbiAgY29uc3QgY29uZmlnMiA9IGF3YWl0IG5ldyBDb25maWd1cmF0aW9uKHsgcmVhZFVzZXJDb250ZXh0OiBmYWxzZSB9KS5sb2FkKCk7XG5cbiAgLy8gVEhFTlxuICBleHBlY3QoY29uZmlnMi5jb250ZXh0LmdldCgnc29tZV9rZXknKSkudG9FcXVhbCh1bmRlZmluZWQpO1xufSk7XG5cbnRlc3QoJ2Nhbm5vdCBzYXZlIHJlYWRvbmx5IHZhbHVlcycsIGFzeW5jICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgY29uc3Qgc2V0dGluZ3MgPSBuZXcgU2V0dGluZ3MoeyBmb286ICdiYXInLCBib286ICdmYXInIH0sIHRydWUpO1xuICBjb25zdCBjb250ZXh0ID0gbmV3IENvbnRleHQoe1xuICAgIGZpbGVOYW1lOiBQUk9KRUNUX0NPTkZJRyxcbiAgICBiYWc6IHNldHRpbmdzLFxuICB9KTtcblxuICAvLyBUSEVOXG4gIGF3YWl0IGV4cGVjdChjb250ZXh0LnNhdmUoUFJPSkVDVF9DT05GSUcpKS5yZWplY3RzLnRvVGhyb3coL0NvbnRleHQgZmlsZSBjZGsuanNvbiBpcyByZWFkIG9ubHkhLyk7XG59KTtcbiJdfQ==