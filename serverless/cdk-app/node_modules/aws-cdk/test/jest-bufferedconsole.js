"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const jest_environment_node_1 = require("jest-environment-node");
class TestEnvironment extends jest_environment_node_1.TestEnvironment {
    constructor(config, context) {
        super(config, context);
        this.log = new Array();
        // We need to set the event handler by assignment in the constructor,
        // because if we declare it as an async member TypeScript's type derivation
        // doesn't work properly.
        this.handleTestEvent = (async (event, _state) => {
            if (event.name === 'test_done' && event.test.errors.length > 0 && this.log.length > 0) {
                this.originalConsole.log(`[Console output] ${fullTestName(event.test)}\n`);
                for (const item of this.log) {
                    this.originalConsole[item.type]('    ' + item.message);
                }
                this.originalConsole.log('\n');
            }
            if (event.name === 'test_done') {
                this.log = [];
            }
        });
    }
    async setup() {
        await super.setup();
        this.log = [];
        this.originalConsole = console;
        this.originalStdoutWrite = process.stdout.write;
        this.originalStderrWrite = process.stderr.write;
        this.global.console = {
            ...console,
            log: (message) => this.log.push({ type: 'log', message }),
            error: (message) => this.log.push({ type: 'error', message }),
            warn: (message) => this.log.push({ type: 'warn', message }),
            info: (message) => this.log.push({ type: 'info', message }),
            debug: (message) => this.log.push({ type: 'debug', message }),
        };
        const self = this;
        process.stdout.write = function (chunk, enccb) {
            const encoding = typeof enccb === 'string' ? enccb : 'utf-8';
            const message = Buffer.isBuffer(chunk) ? chunk.toString(encoding) : chunk;
            self.log.push({ type: 'log', message: message.replace(/\n$/, '') });
            if (typeof enccb === 'function') {
                enccb();
            }
        };
        process.stderr.write = function (chunk, enccb) {
            const encoding = typeof enccb === 'string' ? enccb : 'utf-8';
            const message = Buffer.isBuffer(chunk) ? chunk.toString(encoding) : chunk;
            self.log.push({ type: 'error', message: message.replace(/\n$/, '') });
            if (typeof enccb === 'function') {
                enccb();
            }
        };
    }
    async teardown() {
        this.global.console = this.originalConsole;
        process.stdout.write = this.originalStdoutWrite;
        process.stderr.write = this.originalStderrWrite;
        await super.teardown();
    }
}
exports.default = TestEnvironment;
function fullTestName(test) {
    let ret = test.name;
    while (test.parent != null && test.parent.name !== 'ROOT_DESCRIBE_BLOCK') {
        ret = test.parent.name + ' â€º ' + fullTestName;
        test = test.parent;
    }
    return ret;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiamVzdC1idWZmZXJlZGNvbnNvbGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJqZXN0LWJ1ZmZlcmVkY29uc29sZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQU1BLGlFQUEyRTtBQU8zRSxNQUFxQixlQUFnQixTQUFRLHVDQUFlO0lBTzFELFlBQVksTUFBNkIsRUFBRSxPQUEyQjtRQUNwRSxLQUFLLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBUGpCLFFBQUcsR0FBRyxJQUFJLEtBQUssRUFBa0IsQ0FBQztRQVN4QyxxRUFBcUU7UUFDckUsMkVBQTJFO1FBQzNFLHlCQUF5QjtRQUN4QixJQUFpQyxDQUFDLGVBQWUsR0FBRyxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEVBQUU7WUFDNUUsSUFBSSxLQUFLLENBQUMsSUFBSSxLQUFLLFdBQVcsSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO2dCQUN0RixJQUFJLENBQUMsZUFBZSxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsWUFBWSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzNFLEtBQUssTUFBTSxJQUFJLElBQUksSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO29CQUM1QixJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUN6RCxDQUFDO2dCQUNELElBQUksQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2pDLENBQUM7WUFFRCxJQUFJLEtBQUssQ0FBQyxJQUFJLEtBQUssV0FBVyxFQUFFLENBQUM7Z0JBQy9CLElBQUksQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDO1lB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QUN0RSxJQUFJLE9BQU8sS0FBSyxLQUFLLFVBQVUsRUFBRSxDQUFDO2dCQUNoQyxLQUFLLEVBQUUsQ0FBQztZQUNWLENBQUM7UUFDSCxDQUFRLENBQUM7SUFDWCxDQUFDO0lBRUQsS0FBSyxDQUFDLFFBQVE7UUFDWixJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDO1FBQzNDLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQztRQUNoRCxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUM7UUFDaEQsTUFBTSxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDekIsQ0FBQztDQUNGO0FBdEVELGtDQXNFQztBQVFELFNBQVMsWUFBWSxDQUFDLElBQXFCO0lBQ3pDLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7SUFDcEIsT0FBTyxJQUFJLENBQUMsTUFBTSxJQUFJLElBQUksSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksS0FBSyxxQkFBcUIsRUFBRSxDQUFDO1FBQ3pFLEdBQUcsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksR0FBRyxLQUFLLEdBQUcsWUFBWSxDQUFDO1FBQzlDLElBQUksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQ3JCLENBQUM7SUFDRCxPQUFPLEdBQUcsQ0FBQztBQUNiLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBpbXBvcnQvbm8tZXh0cmFuZW91cy1kZXBlbmRlbmNpZXMgKi9cbi8qKlxuICogQSBKZXN0IGVudmlyb25tZW50IHRoYXQgYnVmZmVycyBvdXRwdXRzIHRvIGBjb25zb2xlLmxvZygpYCBhbmQgb25seSBzaG93cyBpdCBmb3IgZmFpbGluZyB0ZXN0cy5cbiAqL1xuaW1wb3J0IHR5cGUgeyBFbnZpcm9ubWVudENvbnRleHQsIEplc3RFbnZpcm9ubWVudCwgSmVzdEVudmlyb25tZW50Q29uZmlnIH0gZnJvbSAnQGplc3QvZW52aXJvbm1lbnQnO1xuaW1wb3J0IHsgQ2lyY3VzIH0gZnJvbSAnQGplc3QvdHlwZXMnO1xuaW1wb3J0IHsgVGVzdEVudmlyb25tZW50IGFzIE5vZGVFbnZpcm9ubWVudCB9IGZyb20gJ2plc3QtZW52aXJvbm1lbnQtbm9kZSc7XG5cbmludGVyZmFjZSBDb25zb2xlTWVzc2FnZSB7XG4gIHR5cGU6ICdsb2cnIHwgJ2Vycm9yJyB8ICd3YXJuJyB8ICdpbmZvJyB8ICdkZWJ1Zyc7XG4gIG1lc3NhZ2U6IHN0cmluZztcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGVzdEVudmlyb25tZW50IGV4dGVuZHMgTm9kZUVudmlyb25tZW50IGltcGxlbWVudHMgSmVzdEVudmlyb25tZW50PHVua25vd24+IHtcbiAgcHJpdmF0ZSBsb2cgPSBuZXcgQXJyYXk8Q29uc29sZU1lc3NhZ2U+KCk7XG5cbiAgcHJpdmF0ZSBvcmlnaW5hbENvbnNvbGUhOiB0eXBlb2YgY29uc29sZTtcbiAgcHJpdmF0ZSBvcmlnaW5hbFN0ZG91dFdyaXRlITogdHlwZW9mIHByb2Nlc3Muc3Rkb3V0LndyaXRlO1xuICBwcml2YXRlIG9yaWdpbmFsU3RkZXJyV3JpdGUhOiB0eXBlb2YgcHJvY2Vzcy5zdGRlcnIud3JpdGU7XG5cbiAgY29uc3RydWN0b3IoY29uZmlnOiBKZXN0RW52aXJvbm1lbnRDb25maWcsIGNvbnRleHQ6IEVudmlyb25tZW50Q29udGV4dCkge1xuICAgIHN1cGVyKGNvbmZpZywgY29udGV4dCk7XG5cbiAgICAvLyBXZSBuZWVkIHRvIHNldCB0aGUgZXZlbnQgaGFuZGxlciBieSBhc3NpZ25tZW50IGluIHRoZSBjb25zdHJ1Y3RvcixcbiAgICAvLyBiZWNhdXNlIGlmIHdlIGRlY2xhcmUgaXQgYXMgYW4gYXN5bmMgbWVtYmVyIFR5cGVTY3JpcHQncyB0eXBlIGRlcml2YXRpb25cbiAgICAvLyBkb2Vzbid0IHdvcmsgcHJvcGVybHkuXG4gICAgKHRoaXMgYXMgSmVzdEVudmlyb25tZW50PHVua25vd24+KS5oYW5kbGVUZXN0RXZlbnQgPSAoYXN5bmMgKGV2ZW50LCBfc3RhdGUpID0+IHtcbiAgICAgIGlmIChldmVudC5uYW1lID09PSAndGVzdF9kb25lJyAmJiBldmVudC50ZXN0LmVycm9ycy5sZW5ndGggPiAwICYmIHRoaXMubG9nLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdGhpcy5vcmlnaW5hbENvbnNvbGUubG9nKGBbQ29uc29sZSBvdXRwdXRdICR7ZnVsbFRlc3ROYW1lKGV2ZW50LnRlc3QpfVxcbmApO1xuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGhpcy5sb2cpIHtcbiAgICAgICAgICB0aGlzLm9yaWdpbmFsQ29uc29sZVtpdGVtLnR5cGVdKCcgICAgJyArIGl0ZW0ubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5vcmlnaW5hbENvbnNvbGUubG9nKCdcXG4nKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGV2ZW50Lm5hbWUgPT09ICd0ZXN0X2RvbmUnKSB7XG4gICAgICAgIHRoaXMubG9nID0gW107XG4gICAgICB9XG4gICAgfSkgc2F0aXNmaWVzIENpcmN1cy5FdmVudEhhbmRsZXI7XG4gIH1cblxuICBhc3luYyBzZXR1cCgpIHtcbiAgICBhd2FpdCBzdXBlci5zZXR1cCgpO1xuXG4gICAgdGhpcy5sb2cgPSBbXTtcbiAgICB0aGlzLm9yaWdpbmFsQ29uc29sZSA9IGNvbnNvbGU7XG4gICAgdGhpcy5vcmlnaW5hbFN0ZG91dFdyaXRlID0gcHJvY2Vzcy5zdGRvdXQud3JpdGU7XG4gICAgdGhpcy5vcmlnaW5hbFN0ZGVycldyaXRlID0gcHJvY2Vzcy5zdGRlcnIud3JpdGU7XG5cbiAgICB0aGlzLmdsb2JhbC5jb25zb2xlID0ge1xuICAgICAgLi4uY29uc29sZSxcbiAgICAgIGxvZzogKG1lc3NhZ2UpID0+IHRoaXMubG9nLnB1c2goeyB0eXBlOiAnbG9nJywgbWVzc2FnZSB9KSxcbiAgICAgIGVycm9yOiAobWVzc2FnZSkgPT4gdGhpcy5sb2cucHVzaCh7IHR5cGU6ICdlcnJvcicsIG1lc3NhZ2UgfSksXG4gICAgICB3YXJuOiAobWVzc2FnZSkgPT4gdGhpcy5sb2cucHVzaCh7IHR5cGU6ICd3YXJuJywgbWVzc2FnZSB9KSxcbiAgICAgIGluZm86IChtZXNzYWdlKSA9PiB0aGlzLmxvZy5wdXNoKHsgdHlwZTogJ2luZm8nLCBtZXNzYWdlIH0pLFxuICAgICAgZGVidWc6IChtZXNzYWdlKSA9PiB0aGlzLmxvZy5wdXNoKHsgdHlwZTogJ2RlYnVnJywgbWVzc2FnZSB9KSxcbiAgICB9O1xuXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUgPSBmdW5jdGlvbiAoY2h1bms6IEJ1ZmZlciB8IHN0cmluZywgZW5jY2I/OiBCdWZmZXJFbmNvZGluZyB8ICgoZXJyb3I/OiBFcnJvciB8IG51bGwpID0+IHZvaWQpKTogdm9pZCB7XG4gICAgICBjb25zdCBlbmNvZGluZyA9IHR5cGVvZiBlbmNjYiA9PT0gJ3N0cmluZycgPyBlbmNjYiA6ICd1dGYtOCc7XG4gICAgICBjb25zdCBtZXNzYWdlID0gQnVmZmVyLmlzQnVmZmVyKGNodW5rKSA/IGNodW5rLnRvU3RyaW5nKGVuY29kaW5nKSA6IGNodW5rO1xuICAgICAgc2VsZi5sb2cucHVzaCh7IHR5cGU6ICdsb2cnLCBtZXNzYWdlOiBtZXNzYWdlLnJlcGxhY2UoL1xcbiQvLCAnJykgfSk7XG4gICAgICBpZiAodHlwZW9mIGVuY2NiID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGVuY2NiKCk7XG4gICAgICB9XG4gICAgfSBhcyBhbnk7XG4gICAgcHJvY2Vzcy5zdGRlcnIud3JpdGUgPSBmdW5jdGlvbiAoY2h1bms6IEJ1ZmZlciB8IHN0cmluZywgZW5jY2I/OiBCdWZmZXJFbmNvZGluZyB8ICgoZXJyb3I/OiBFcnJvciB8IG51bGwpID0+IHZvaWQpKTogdm9pZCB7XG4gICAgICBjb25zdCBlbmNvZGluZyA9IHR5cGVvZiBlbmNjYiA9PT0gJ3N0cmluZycgPyBlbmNjYiA6ICd1dGYtOCc7XG4gICAgICBjb25zdCBtZXNzYWdlID0gQnVmZmVyLmlzQnVmZmVyKGNodW5rKSA/IGNodW5rLnRvU3RyaW5nKGVuY29kaW5nKSA6IGNodW5rO1xuICAgICAgc2VsZi5sb2cucHVzaCh7IHR5cGU6ICdlcnJvcicsIG1lc3NhZ2U6IG1lc3NhZ2UucmVwbGFjZSgvXFxuJC8sICcnKSB9KTtcbiAgICAgIGlmICh0eXBlb2YgZW5jY2IgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgZW5jY2IoKTtcbiAgICAgIH1cbiAgICB9IGFzIGFueTtcbiAgfVxuXG4gIGFzeW5jIHRlYXJkb3duKCkge1xuICAgIHRoaXMuZ2xvYmFsLmNvbnNvbGUgPSB0aGlzLm9yaWdpbmFsQ29uc29sZTtcbiAgICBwcm9jZXNzLnN0ZG91dC53cml0ZSA9IHRoaXMub3JpZ2luYWxTdGRvdXRXcml0ZTtcbiAgICBwcm9jZXNzLnN0ZGVyci53cml0ZSA9IHRoaXMub3JpZ2luYWxTdGRlcnJXcml0ZTtcbiAgICBhd2FpdCBzdXBlci50ZWFyZG93bigpO1xuICB9XG59XG5cbi8vIERlc2NyaWJlQmxvY2sgaXMgbm90IGV4cG9ydGVkIGZyb20gYEBqZXN0L3R5cGVzYCwgc28gd2UgbmVlZCB0byBidWlsZCB0aGUgcGFydHMgd2UgYXJlIGludGVyZXN0ZWQgaW5cbnR5cGUgVGVzdERlc2NyaXB0aW9uID0gUGFydGlhbEJ5PFBpY2s8Q2lyY3VzLlRlc3RFbnRyeSwgJ25hbWUnIHwgJ3BhcmVudCc+LCAncGFyZW50Jz47XG5cbi8vIFV0aWxpdHkgdHlwZSB0byBtYWtlIHNwZWNpZmljIGZpZWxkcyBvcHRpb25hbFxudHlwZSBQYXJ0aWFsQnk8VCwgSyBleHRlbmRzIGtleW9mIFQ+ID0gT21pdDxULCBLPiAmIFBhcnRpYWw8UGljazxULCBLPj5cblxuZnVuY3Rpb24gZnVsbFRlc3ROYW1lKHRlc3Q6IFRlc3REZXNjcmlwdGlvbikge1xuICBsZXQgcmV0ID0gdGVzdC5uYW1lO1xuICB3aGlsZSAodGVzdC5wYXJlbnQgIT0gbnVsbCAmJiB0ZXN0LnBhcmVudC5uYW1lICE9PSAnUk9PVF9ERVNDUklCRV9CTE9DSycpIHtcbiAgICByZXQgPSB0ZXN0LnBhcmVudC5uYW1lICsgJyDigLogJyArIGZ1bGxUZXN0TmFtZTtcbiAgICB0ZXN0ID0gdGVzdC5wYXJlbnQ7XG4gIH1cbiAgcmV0dXJuIHJldDtcbn1cbiJdfQ==